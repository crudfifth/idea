ã„ã¡ãŠã†ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯è¨­å®šã—ã¦ã„ã‚‹ã®ã§pushã™ã‚‹ã¨GitLab Runnerä¸Šã§ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã¯å‹•ãã¾ã™ã€‚
ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ã‚³ãƒ¡ãƒ³ãƒˆã«ã—ã¦ã„ã¾ã™ã€‚
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®npmã®ã‚³ãƒãƒ³ãƒ‰ã¯wikiã«æ·»ä»˜ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®package.jsonã®ã‚‚ã®ã‚’å½“ã¦ã¦ã„ã¾ã™ã€‚
ä¿®æ­£ãŒå¿…è¦ã§ã‚ã‚Œã°æå®¶ã€å±±ç”°ã•ã‚“ã®æ–¹ã«é€£çµ¡ãã ã•ã„ã€‚

# TypeScript + Vitest ã«ã‚ˆã‚‹å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…æ‰‹é †

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€**TypeScript** ç’°å¢ƒã«ãŠã„ã¦ **Vitest + Vue Testing Library + MSW** ã‚’ä½¿ç”¨ã—ã¦ã€**å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•** ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## 1. å˜ä½“ãƒ†ã‚¹ãƒˆã®åŸºæœ¬æ§‹æˆ

å˜ä½“ãƒ†ã‚¹ãƒˆã¯ **`__tests__` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** ã«é…ç½®ã—ã€`.test.ts` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ä½œæˆã—ã¾ã™ã€‚  
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã€**Vue Testing Library** ã‚’ç”¨ã„ã¦ UI ã®æŒ¯ã‚‹èˆã„æ¤œè¨¼ã‚’è¡Œã†ã€‚

### ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆäº‹ä¾‹ï¼‰

src/  
â””â”€â”€ components/   
&emsp;&emsp;&emsp;â””â”€â”€ button/  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;â”œâ”€â”€ Button.vue  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;â””â”€â”€ \_\_tests\_\_/  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;â””â”€â”€ Button.test.ts  

## 2. ãƒ†ã‚¹ãƒˆã®åŸºæœ¬çš„ãªæ›¸ãæ–¹

### 2.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
ğŸ“„ src/components/App.vue
```html
<!-- ã“ã®ã‚ˆã†ãªè¦ªã‚³ãƒ³ãƒãŒã‚ã‚‹ã¨ã—ãŸã¨ãã®ä¾‹ -->
<template>
  <div>
    <Button label="ã‚¯ãƒªãƒƒã‚¯" :primary="true" />
  </div>
</template>

<script setup lang="ts">
import { ref } from "vue";
import Button from "./components/Button.vue"; // å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
</script>
``` 

ğŸ“„ `src/components/Button.vue`
```typescript
<!-- ä¸‹è¨˜ã¯ãƒœã‚¿ãƒ³ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹ -->
<template>
  <!-- å‡¦ç†å†…å®¹: primary ãŒ true ã®å ´åˆã€primary ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨ > ã‚¯ãƒªãƒƒã‚¯æ™‚ã« onClick ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ -->

  <!-- 4. button è¦ç´ ãŒç”Ÿæˆã•ã‚Œã€primary ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹ -->
  <button :class="{ primary: primary }" @click="onClick">{{ label }}</button>
</template>

<script setup lang="ts">
import { defineProps, defineEmits } from "vue";

// 1.ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ï¼ˆãƒ©ãƒ™ãƒ«ã¨ primary ãƒ•ãƒ©ã‚°ï¼‰
defineProps<{ label: string; primary?: boolean }>();

// 2.ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¦ªã«é€šçŸ¥
const emit = defineEmits(["click"]);

// 3.ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
const onClick = () => {
  emit("click"); 
};
</script>

<style scoped>
/* primary ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.primary {
  background-color: blue;
  color: white;
}
</style>
```

### 2.2 å˜ä½“ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

ğŸ“„ `src/components/button/__tests__/Button.test.ts`
```typescript
// ãƒ†ã‚¹ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { render, screen } from "@testing-library/vue"; // Vue Testing Library ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
import userEvent from "@testing-library/user-event"; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
import { describe, it, expect } from "vitest"; // Vitest ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import Button from "../Button.vue"; // ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

describe("Button.vue", () => {

  // ãƒœã‚¿ãƒ³ãŒæŒ‡å®šã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  it("æŒ‡å®šã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã®ãƒœã‚¿ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹", () => {
    render(Button, { props: { label: "Click me" } }); // ãƒœã‚¿ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    expect(screen.getByText("Click me")).toBeInTheDocument(); // æŒ‡å®šã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã®ãƒœã‚¿ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
  });

  // primary ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ true ã®å ´åˆã€ãƒœã‚¿ãƒ³ã« primary ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  it("primary ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ true ã®å ´åˆã« primary ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹", () => {
    render(Button, { props: { label: "Primary", primary: true } }); // primary ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä»˜ãã§ãƒœã‚¿ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const button = screen.getByText("Primary"); // ãƒœã‚¿ãƒ³è¦ç´ ã‚’å–å¾—
    expect(button).toHaveClass("primary"); // ãƒœã‚¿ãƒ³ã« primary ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
  });

  // ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã« click ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã‚’ç¢ºèª
  it("ã‚¯ãƒªãƒƒã‚¯æ™‚ã« click ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã™ã‚‹", async () => {
    const { emitted } = render(Button, { props: { label: "Click me" } }); // ãƒœã‚¿ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    await userEvent.click(screen.getByText("Click me")); // ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    expect(emitted()).toHaveProperty("click"); // click ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸã“ã¨ã‚’æ¤œè¨¼
  });
});

```

### **ä¸Šè¨˜ãƒ†ã‚¹ãƒˆã®ãƒã‚¤ãƒ³ãƒˆ**
- `render(Component, { props })` â†’ ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä»®æƒ³DOMã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- `screen.getByText("ãƒ†ã‚­ã‚¹ãƒˆ")` â†’ æŒ‡å®šã—ãŸãƒ†ã‚­ã‚¹ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
- `userEvent.click()` â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
- `expect(emitted()).toHaveProperty("click")` â†’ `click` ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã“ã¨ã‚’æ¤œè¨¼

## 3. APIé€šä¿¡ã‚’å«ã‚€ãƒ†ã‚¹ãƒˆï¼ˆMSWã‚’åˆ©ç”¨ï¼‰

### 3.1 APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

ğŸ“„ `src/components/UserList.vue`
```Typescript
<template>
  <div>
    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒœã‚¿ãƒ³ -->
    <button @click="fetchUsers">Load Users</button>
    
    <ul>
      <!-- å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤º -->
      <li v-for="user in users" :key="user.id">{{ user.name }}</li>
    </ul>

  </div>
</template>

<script setup lang="ts">
import { ref } from "vue";

// 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¤‰æ•°
const users = ref<{ id: number; name: string }[]>([]);

// 2. APIã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
const fetchUsers = async () => {
  try {
    // 2-1. APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆéåŒæœŸå‡¦ç†ï¼‰
    const response = await fetch("/api/users");
    
    // 2-2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
    if (!response.ok) {
      throw new Error("Failed to fetch users");
    }

    // 2-3. å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ users ã«æ ¼ç´
    users.value = await response.json();
  } catch (error) {
    console.error("ãƒ¦ãƒ¼ã‚¶å–å¾—ã‚¨ãƒ©ãƒ¼", error);
  }
};
</script>

```

### 3.2 MSWã§APIãƒ¢ãƒƒã‚¯ã‚’è¨­å®š

ğŸ“„ `src/mocks/handlers.ts`
```typescript
import { http } from "msw";

// ãƒ¢ãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®šç¾©
export const handlers = [

  // "/api/users" ã¸ã®GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
  http.get("/api/users", () => {
    
    // ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
    return new Response(
      JSON.stringify([
        { id: 1, name: "å±±ç”°" },
        { id: 2, name: "ç”°ä¸­" }
      ]),
      {
        status: 200,
        headers: { "Content-Type": "application/json" }
      }
    );
  }),
];
```

ğŸ“„ `src/mocks/server.ts`
```typescript
import { setupServer } from "msw/node"; // Node.js ç’°å¢ƒç”¨ã®MSWã‚µãƒ¼ãƒãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { handlers } from "./handlers"; // å®šç¾©æ¸ˆã¿APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

// `handlers` ã«å®šç¾©ã•ã‚ŒãŸAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ¢ãƒƒã‚¯ã‚’ç™»éŒ²
export const server = setupServer(...handlers);
```

### 3.3 APIã‚’å«ã‚€ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

ğŸ“„ `src/components/__tests__/UserList.test.ts`
```typescript
import { render, screen } from "@testing-library/vue";
import userEvent from "@testing-library/user-event";
import { describe, it, expect, beforeAll, afterEach, afterAll } from "vitest";
import UserList from "../UserList.vue";
import { server } from "../../mocks/server";

// MSWã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

describe("UserList.vue", () => {
  it("fetches and displays users", async () => {
    render(UserList);
    await userEvent.click(screen.getByText("Load Users"));

    expect(await screen.findByText("Alice")).toBeInTheDocument();
    expect(screen.getByText("Bob")).toBeInTheDocument();
  });
});
```

### **ä¸Šè¨˜ãƒ†ã‚¹ãƒˆã®ãƒã‚¤ãƒ³ãƒˆ**
- `server.listen()` â†’ ãƒ†ã‚¹ãƒˆå‰ã«MSWã‚’èµ·å‹•
- `await screen.findByText("Alice")` â†’ éåŒæœŸã§ãƒ‡ãƒ¼ã‚¿ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã®ã‚’å¾…æ©Ÿ
- `server.resetHandlers()` â†’ ãƒ†ã‚¹ãƒˆã”ã¨ã«MSWã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ

## 4. ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
npm run test
```
- `npm run test` â†’ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
- `npm run test:watch` â†’ å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•å®Ÿè¡Œ

ã¾ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒ«ã¨ã—ã¦Gitãƒ•ãƒƒã‚¯ã«ã‚ˆã‚ŠPreã‚³ãƒŸãƒƒãƒˆã«ã‚ˆã‚Šãƒ†ã‚¹ãƒˆãŒèµ°ã‚‹è¨­å®šã«ãªã£ã¦ã„ã¾ã™ã€‚

